<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Prediksi Risiko Banjir (Multi-Model AI)</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --background-color: #f8f9fa;
            --text-color: #343a40;
            --risk-low: #28a745; /* Hijau */
            --risk-medium: #ffc107; /* Kuning */
            --risk-high: #dc3545; /* Merah */
            --header-bg: #e9ecef;
        }

        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        header {
            background-color: var(--header-bg);
            color: var(--text-color);
            padding: 20px 0;
            text-align: center;
            border-bottom: 3px solid var(--primary-color);
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
        }

        nav {
            margin-top: 10px;
        }

        nav a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 15px;
            font-weight: bold;
        }

        .container {
            width: 85%;
            margin: 40px auto;
            padding: 20px;
            background: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }

        .section {
            padding: 30px 0;
            border-bottom: 1px solid #dee2e6;
        }

        .section h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
        }

        .card-grid {
            display: flex;
            justify-content: space-around;
            gap: 20px;
            flex-wrap: wrap;
        }

        .card {
            background: #ffffff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            width: 30%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
        }

        .input-group input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .predict-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .predict-button:hover {
            background-color: #0056b3;
        }

        #prediction-result {
            margin-top: 30px;
            padding: 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            border-radius: 6px;
            background-color: #e2e6ea;
            color: var(--text-color);
            transition: all 0.5s ease;
        }

        .risk-low {
            background-color: var(--risk-low);
            color: white !important;
        }

        .risk-medium {
            background-color: var(--risk-medium);
            color: black !important;
        }

        .risk-high {
            background-color: var(--risk-high);
            color: white !important;
        }
    </style>
</head>
<body>

    <header>
        <h1>Flood Risk Prediction System</h1>
        <nav>
            <a href="#about">Tentang</a>
            <a href="#features">Fitur</a>
            <a href="#demo">Demo Prediksi</a>
        </nav>
    </header>

    <div class="container">
        <section class="section" id="about">
            <h2>Latar Belakang Proyek</h2>
            <p style="text-align: justify;">Indonesia adalah salah satu negara dengan risiko banjir tertinggi di dunia, dengan lebih dari 30% bencana tahunan disebabkan oleh banjir. Sistem peringatan dini konvensional seringkali tidak efektif karena kurangnya analisis prediktif. Proyek ini bertujuan mengembangkan **Sistem Prediksi Risiko Banjir** berbasis Machine Learning untuk memberikan peringatan dini yang akurat menggunakan data cuaca (Curah Hujan, Kelembapan, dan Ketinggian Wilayah).</p>
        </section>

        <section class="section" id="features">
            <h2>Fitur Utama Sistem</h2>
            <div class="card-grid">
                <div class="card">
                    <h3>Input & Output Prediksi</h3>
                    <p>Memungkinkan pengguna memasukkan parameter cuaca (Curah Hujan, Kelembapan, Ketinggian) dan menerima hasil klasifikasi risiko (LOW, MEDIUM, HIGH) dari model AI.</p>
                </div>
                <div class="card">
                    <h3>Visualisasi Peta Risiko</h3>
                    <p>Menampilkan hasil prediksi risiko secara geografis menggunakan *heatmap* di peta, membantu identifikasi cepat zona bahaya.</p>
                </div>
                <div class="card">
                    <h3>Notifikasi Peringatan Dini</h3>
                    <p>Sistem akan mengirimkan peringatan instan kepada otoritas dan masyarakat ketika prediksi risiko mencapai level MEDIUM atau HIGH.</p>
                </div>
            </div>
        </section>

        <section class="section" id="demo">
            <h2>DEMO PREDIKSI RISIKO BANJIR (MULTI-MODEL)</h2>
            <p style="text-align: center; margin-bottom: 40px;">Pilih model untuk menguji prediksi risiko banjir.</p>

            <div style="text-align: center; margin-bottom: 20px;">
                <label style="font-weight: bold; margin-right: 10px;">Pilih Model:</label>
                <input type="radio" id="model-rf" name="model_choice" value="RF" checked onclick="toggleInputMode('RF')">
                <label for="model-rf">Random Forest (Prediksi Harian)</label>
                
                <input type="radio" id="model-lstm" name="model_choice" value="LSTM" onclick="toggleInputMode('LSTM')" style="margin-left: 20px;">
                <label for="model-lstm">LSTM (Prediksi Berbasis Tren 3 Hari)</label>
            </div>

            <div id="rf-input-area">
                <h3 style="text-align: center; color: var(--secondary-color);">Input Random Forest (Data Hari Ini)</h3>
                <div class="input-grid">
                    <div class="input-group"><label for="rainfall">Curah Hujan (mm/hari)</label><input type="number" class="rf-input" id="rainfall" value="50" min="0" required></div>
                    <div class="input-group"><label for="humidity">Kelembapan (%)</label><input type="number" class="rf-input" id="humidity" value="75" min="0" max="100" required></div>
                    <div class="input-group"><label for="elevation">Ketinggian Wilayah (mdpl)</label><input type="number" class="rf-input" id="elevation" value="50" required></div>
                    <div class="input-group"><label for="temp">Suhu (°C) - (Fitur Tambahan)</label><input type="number" id="temp" value="28" min="-50" max="50" required></div>
                </div>
            </div>

            <div id="lstm-input-area" style="display: none;">
                <h3 style="text-align: center; color: var(--secondary-color);">Input LSTM (Data 3 Hari Terakhir: R=Rainfall, H=Humidity, E=Elevation)</h3>
                <p style="text-align: center; font-size: 0.9em;">Masukkan 9 nilai: R, H, E (Hari-1); R, H, E (Hari-2); R, H, E (Hari-3)</p>
                <div class="input-grid">
                    <div class="input-group"><label>HARI 1 - R</label><input type="number" class="lstm-input" id="d1_r" value="30"></div>
                    <div class="input-group"><label>HARI 1 - H</label><input type="number" class="lstm-input" id="d1_h" value="70"></div>
                    <div class="input-group"><label>HARI 1 - E</label><input type="number" class="lstm-input" id="d1_e" value="100"></div>
                    
                    <div class="input-group"><label>HARI 2 - R</label><input type="number" class="lstm-input" id="d2_r" value="50"></div>
                    <div class="input-group"><label>HARI 2 - H</label><input type="number" class="lstm-input" id="d2_h" value="80"></div>
                    <div class="input-group"><label>HARI 2 - E</label><input type="number" class="lstm-input" id="d2_e" value="50"></div>

                    <div class="input-group"><label>HARI 3 - R</label><input type="number" class="lstm-input" id="d3_r" value="70"></div>
                    <div class="input-group"><label>HARI 3 - H</label><input type="number" class="lstm-input" id="d3_h" value="90"></div>
                    <div class="input-group"><label>HARI 3 - E</label><input type="number" class="lstm-input" id="d3_e" value="10"></div>
                </div>
            </div>

            <button class="predict-button" onclick="runPrediction()">
                JALANKAN PREDIKSI MULTI-MODEL
            </button>

            <div id="prediction-result">
                Pilih model dan masukkan data.
            </div>
        </section>
    </div>

    <footer>
        <p style="text-align: center; padding: 10px; font-size: 0.8em; color: #6c757d;">© 2025 Flood Risk Prediction System - Kelompok 1</p>
    </footer>

    <script>
        // URL endpoint server Flask
        const API_ENDPOINT = 'http://127.0.0.1:5000/predict'; 
        const resultDiv = document.getElementById('prediction-result');

        // Fungsi untuk mengganti tampilan input berdasarkan pilihan model
        function toggleInputMode(model) {
            if (model === 'RF') {
                document.getElementById('rf-input-area').style.display = 'block';
                document.getElementById('lstm-input-area').style.display = 'none';
            } else if (model === 'LSTM') {
                document.getElementById('rf-input-area').style.display = 'none';
                document.getElementById('lstm-input-area').style.display = 'block';
            }
        }

        async function runPrediction() {
            // Dapatkan pilihan model yang sedang aktif
            const modelChoice = document.querySelector('input[name="model_choice"]:checked').value;
            let requestBody = {};
            
            resultDiv.className = '';
            resultDiv.textContent = 'Memproses data ke server AI...';

            // 1. Kumpulkan Data berdasarkan Pilihan Model
            if (modelChoice === 'RF') {
                // Kumpulkan 3 fitur untuk Random Forest
                const rainfall = parseFloat(document.getElementById('rainfall').value);
                const humidity = parseFloat(document.getElementById('humidity').value);
                const elevation = parseFloat(document.getElementById('elevation').value);
                
                // Validasi Input RF
                if (isNaN(rainfall) || isNaN(humidity) || isNaN(elevation)) {
                    resultDiv.textContent = 'Data Random Forest tidak valid. Mohon isi semua input.';
                    resultDiv.classList.add('risk-medium');
                    return;
                }
                
                requestBody = {
                    model_choice: 'RF',
                    rainfall: rainfall,
                    humidity: humidity,
                    elevation: elevation
                };

            } else if (modelChoice === 'LSTM') {
                // Kumpulkan 9 fitur (3 hari x 3 fitur) untuk LSTM
                const sequenceInputs = ['d1_r', 'd1_h', 'd1_e', 'd2_r', 'd2_h', 'd2_e', 'd3_r', 'd3_h', 'd3_e'];
                const sequenceData = sequenceInputs.map(id => parseFloat(document.getElementById(id).value));

                // Validasi Input LSTM (memastikan semua 9 nilai adalah angka)
                if (sequenceData.some(isNaN) || sequenceData.length !== 9) {
                    resultDiv.textContent = 'Data Sekuens LSTM tidak valid. Mohon isi semua 9 input.';
                    resultDiv.classList.add('risk-medium');
                    return;
                }
                
                requestBody = {
                    model_choice: 'LSTM',
                    // Mengirim 9 nilai sebagai array
                    sequence_data: sequenceData 
                };
            }

            // 2. Kirim data ke Flask Backend
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                const data = await response.json();

                if (data.status !== 'success') {
                    resultDiv.textContent = `Error dari Server: ${data.error}`;
                    resultDiv.classList.add('risk-high');
                    return;
                }

                // 3. Tampilkan Hasil dari Backend
                const model = data.model;
                const riskLevel = data.risk_level;
                const probability = data.probability;
                
                let riskClass = '';
                if (riskLevel === 'HIGH') { riskClass = 'risk-high'; } 
                else if (riskLevel === 'MEDIUM') { riskClass = 'risk-medium'; } 
                else { riskClass = 'risk-low'; }
                
                const resultText = `MODEL ${model}: PROBABILITAS ${probability}% | RISIKO: ${riskLevel}`;

                // Penundaan kecil untuk efek visual
                setTimeout(() => {
                    resultDiv.textContent = resultText;
                    resultDiv.classList.add(riskClass);
                }, 500);

            } catch (error) {
                console.error('Fetch error:', error);
                resultDiv.textContent = 'ERROR KONEKSI: Server AI (Python) tidak aktif. Pastikan app.py berjalan.';
                resultDiv.classList.add('risk-high');
            }
        }
        
        // Set default input mode saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            toggleInputMode('RF');
        });
    </script>

</body>
</html>
